<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>设备管理</title>
		<link type="text/css" href="js/pager/pager.css" rel="stylesheet" />
	</head>
	<body style="width: 100%;">
		<div>
			<div class="row-fluid" style="width: 95%; height: 10%; margin-left: 1%;">
				<div>
					<h3 class="page-title">设备管理&nbsp;<!-- <small>此功能用于管理当前所有关联设备</small> --></h3>
				</div>
				<ul class="breadcrumb">
					<li><i class="icon-home"></i><span class="icon-angle-right"></span></li>
					<li><a href="#">设备管理</a><span class="icon-angle-right"></span></li>
					<li><a href="#">设备列表</a></li>
				</ul>
			</div>
		</div>
		<!--加载设备列表【开始】-->
		<div class="portlet-body" style="width: 90%; margin: auto;">
			<!-- 按钮列 -->
			<div>
				<div style="margin: 10px 0px;">
					<button class="btn green" onclick="getEquiEdit(null);">新增设备&nbsp;<i class="icon-plus"></i></button>
					<button class="btn blue" onclick="report();" style="margin: 0px 10px;">导出列表</button>
					<input type="text" id="searchByName" placeholder="请输入设备名称查询" style="height: 30px;" value="" onfocus="javascript: this.value=null;"/>
					<button  class="btn blue" onclick="searchResult();"><i class="icon-search"></i></button>
				</div>
			</div>
			<!-- 设备列表【开始】 -->
			<table class="table table-striped table-hover table-bordered" id="sample_editable_1">
				<thead>
					<tr> 
						<th>序号</th>			<th>设备名称</th>	<th>安装地址</th>	<th>地区编码</th>
						<th>经纬度</th>			<th>帧结构</th>	<th>所属用户</th>	<th>创建时间</th>
						<th>更新时间</th>	<th>更新者</th>	<th>操作</th>
					</tr>
				</thead>
				<tbody id="equipmentList"></tbody>
				<tfoot>
					<tr>
						<td colspan="11" align="center">
							<!-- 翻页插件 -->
							<div class="list-page-tail page-down" id="equi-list-pager" style="margin: auto;"></div>
						</td>
					</tr>
				</tfoot>
			</table>
			<!-- 设备列表【结束】 -->
		</div>
		
		
		<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/pager/data_table_pager.js"></script>
		<script>
			jQuery(document).ready(function() {
			   getEquipmentList();
			});
			//获取所有设备信息列表
			var pageNum;
			function getEquipmentList(){
				$.ajax({
					url: "equipment/selectAll",
					type: "post",
					dataType: "json",
					success: function(result){
						var data = result.data;
						//设置分页信息——当前为假分页
						var equipList = "";
						var totalSize = data.length;
						var pageSize = 5;
						var totalNum = Math.ceil(totalSize/pageSize);
						var startIndex = (pageNum-1)*pageSize;
						var endIndex = (pageNum*pageSize>totalSize)?totalSize:pageNum*pageSize;
						for(let i=startIndex; i<endIndex; i++){
							equipList+="<tr>";
							equipList+="<td>"+(i+1)+"</td>";
							equipList+="<td>"+data[i].equipmentName+"</td>";
							equipList+="<td>"+data[i].address+"</td>";
							equipList+="<td>"+data[i].adcode+"</td>";
							equipList+="<td>"+data[i].lngLat+"</td>";
							equipList+="<td>"+data[i].frameStru+"</td>";
							equipList+="<td>"+data[i].userName+"</td>";
							equipList+="<td>"+parent.formatDateToString(new Date(data[i].createTime))+"</td>";
							equipList+="<td>"+parent.formatDateToString(new Date(data[i].updateTime))+"</td>";
							equipList+="<td>"+data[i].updater+"</td>";
							equipList+="<td class=\"center\">";
							/* equipList+="<a class=\"details\" href=\"#\" onclick=\"getChannelDetails('"+data[i].equipmentId+"');\">通道详情</a>&nbsp;"; */
							equipList+="<a class=\"edit\" href=\"#\" onclick=\"getEquiEdit('"+data[i].equipmentId+"');\">编辑</a>&nbsp;";
							equipList+="<a class=\"delete\" href=\"#\"onclick=\"getEquiDelete('"+data[i].equipmentId+"');\">删除</a>&nbsp;";
							equipList+="</td>";
							equipList+="</tr>";
						}
						$("#equipmentList").html(equipList);
						//加载页码
						$("#equi-list-pager").html(loadPages(pageSize,totalSize,pageNum));
						$("#equi-list-pager").setActivePage(3);
					}
				});
			}
			//查看设备详情
			/* function getChannelDetails(param){
				let title="设备通道详情";
				let url = "formHtml/equipment/channel-details.html";
				var params={"width": 700, "height": 800, "equipmentId": param};
				parent.openModal(title, url, params);
			} */
			//编辑或者新增设备信息
			function getEquiEdit(param){
				let title;
				if(param == null){title = "新增设备"; }
				else{title = "编辑设备"; }
				let url = "formHtml/equipment/equi-edit.html";
				var params={"width": 700, "height": 800, "equipmentId": param};
				parent.openModal(title, url, params);
			}
			//删除一条设备信息
			function getEquiDelete(param){
				if(confirm("确定删除此设备？")){
					$.ajax({
						url: "equipment/delete",
						type: "post",
						data: {"equipmentId": param},
						dataType: "json",
						success: function(result){
							if(result.success){ alert("设备删除成功！"); }
							else{ alert("设备删除失败！"); }
							getEquipmentList();
						}
					});
				}
			}
			
			//导出
			function report() {
				$.ajax({
					url : "equipment/recordExport",
					type : "post",
					/* data : {
						"path" : param
					}, */
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("导出成功！");
						} else {
							alert("导出失败！");
						}
					}
				});
			}
		</script>
	</body>
</html>
