<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>当前监测数据</title>
		<style type="text/css">
			#channelDiv .tiaoshijian{font-size: 20px;}
			#channelsInfo td{text-align: left; border: 1px solid #ffffff;}
			#channelsInfo td .span_left{font-size: 25px; color: #ffffff;}
			#channelsInfo td .span_right{font-size: 32px;}
			#channelsInfo .green{background-color: #21242e; color: #00ff00;}
			#channelsInfo .yellow{background-color: #21242e;color: #ffff00;}
			#channelsInfo .red{background-color: #21242e; color: #ff0000;}
			#jk_state{margin-top: 1%; text-align: center;}
		</style>
	</head>
	<body>
		<!-- 上方的统计图【开始】 -->
		<div class="ssjc_right_up" id="chartDiv">
			<div class="nei">
				<div class="ssjc_ru_title">
					<span class="float_right">
						<input type="text" class="biaoti_select" id="jk_state" value="状态：监控中"  />
						<input type="button" class="youcecha" onclick="javascript: parent.changeTabContent(); $('#jk_state').val('状态：已停止');" value="停止监控"  />
						<input type="button" class="youcecha" onclick="javascript: parent.changeTabContent(1); $('#jk_state').val('状态：监控中');" value="继续监控"  />
					</span>
				</div>
				<div class="ssjc_ru_table">
					<div class="echarts_ssjc_one" id="chart_current"></div>
				</div>
			</div>
		</div>
		<!-- 上方的统计图【结束】 -->
		<!-- 下方的统计表【开始】 -->
		<div class="ssjc_right_bottom" id="channelDiv">
			<div class="nei">
				<div class="ssjc_ru_title">
					<span class="tiaoshijian">最新通道温度：(单位：℃)</span>
				</div>
				<!-- 通道温度【开始】 -->
				<div class="ssjc_rub_table">
					<table class="tj_table" border="0" id="channelsInfo">
					</table>
			</div>
		</div>
		<!-- 通道温度【结束】 -->
		
		<script type="text/javascript" src="dist/js/chart/highcharts.js"></script>
		<script type="text/javascript" src="dist/js/chart/high-chart.js"></script>
		<script type="text/javascript">
			//初始化页面信息
			$(function(){ if(equiId!=null){ getEquiData(equiId); } });
			//异步加载通道温度【开始】
			function showBlocks(){
				var url="dataAcquisition/realtime";
				var param={"equipmentId": equiId};
				var result = getCurrentChartData(url, param);
				var data = (result==null)?null:(result.data);
				var channel = "";
				let num = (data==null)?0:(data.length);
				if(num>0){
					let count = Math.ceil(num/3);
					//设定尺寸适应容器【开始】
					//如果只有一排，让容器填充下方位置
					if(count==1){
						$("#channelDiv").css({"height":($(window).height())*0.4});
						//如果只有一个通道，无需设定宽度自适应
						/* if(num<3){
							var tdWidth = $(window).width()*0.2;
							$(".ssjc_rub_table").css({"width": tdWidth*num});
						} */
					}
					var divH=$(window).height()/3;
					var trH=(count==1)?(divH/2+"px;"):(divH/count+"px;");
					var divW=$(window).width()*0.6;
					var tdW=divW/3+"px;";
					//设定尺寸适应容器【结束】
					for(let i=0; i<count; i++){
						let startIndex = 3*i;
						let endIndex = (3*i+3>num)?num:(3*i+3);
						channel+="<tr style='height:"+trH+"'>";
						//通道结果每三个循环一回，缘于界面展示效果较规整
						for(let j=startIndex; j<endIndex; j++){
							let state=parseFloat(data[j].state);
							if(state==5){channel+="<td class='green' style='width:"+tdW+"'><span class='span_left'>"+data[j].opticalFiberPosition+"：</span><span class='span_right'>"+data[j].temperature+"</span></td>"; }
							else if(state==4 || state==3){channel+="<td class='red' style='width:"+tdW+"'><span class='span_left'>"+data[j].opticalFiberPosition+"：</span><span class='span_right'>"+data[j].message+"</span></td>"; }
							else{channel+="<td class='yellow' style='width:"+tdW+"'><span class='span_left'>"+data[j].opticalFiberPosition+"：</span><span class='span_right'>"+data[j].message+"</span></td>"; }
						}
						channel+="</tr>";
					}
				}
				else{channel+="<h3 style='color: red;'>未查找到通道监测信息！</h3>"; }
				$("#channelsInfo").html(channel);
			}
			//异步加载通道温度【结束】
			//绘制温度实时监控表【开始】
			function showCurrentContent(){
				showBlocks();
				initCurrentChart();
			}
			//绘制温度实时监控表【结束】
		</script>
	</body>
</html>