<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>用户信息</title>
<!-- Tell the browser to be responsive to screen width -->
<meta
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
	name="viewport">
<!-- Bootstrap 3.3.7 -->
<link rel="stylesheet"
	href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
<!-- Font Awesome -->
<link rel="stylesheet"
	href="../../bower_components/font-awesome/css/font-awesome.min.css">
<!-- Ionicons -->
<link rel="stylesheet"
	href="../../bower_components/Ionicons/css/ionicons.min.css">
<!-- DataTables -->
<link rel="stylesheet"
	href="../../bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
<link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">
<link rel="stylesheet" href="dist/js/pager/pager.css">
<link rel="stylesheet" href="vince/css/vince.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

<!-- Google Font -->
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>
<body class="hold-transition skin-blue sidebar-mini">
	<div class="fuceng"style="overflow:scroll">
		<div class="fuqu" onclick="tuozhuai('.fuqutitle','.fuqu');">
			<div class="fuquzone">
				<div class="fuqulogo"></div>
				<p class="fuqutitle">
					用户信息 <span class="fuclose" onclick="close2();">×</span>
				</p>
				<div class="fuqubiao" id="userForm">
					<p>
						<span>用户名</span><input type="text" class="right_input" value=""
							id="username" name="userName" />
					</p>
					<p>
						<span>登录密码：</span><input type="password" class="right_input"
							value="" id="password" name="password" />
					</p>
					<p>
						<span>确认密码：</span><input type="password" class="right_input"
							value="" id="confirm" />
					</p>
					<p style="overflow: auto">
						<span>状态：</span>
					<div class="radio">
						<label> <input type="radio" name="optionsRadios"
							id="optionsRadios1" value="option1" checked> 启用
						</label> <label> <input type="radio" name="optionsRadios"
							id="optionsRadios2" value="option2"> 禁用
						</label>
					</div>
					</p>

					<p style="height: 80px;">
						<span>用户属性:</span> <input type="text" class="right_input" value=""
							id="comments" name="comments" />
					</p>
				</div>

				<div class="fuqusave">
					<input type="button" onclick="submitUserInfo();" value="保存">
				</div>
			</div>
		</div>
	</div>

	<div class="wrapper"  >
		<div class="content-wrapper"style="overflow:scroll">
			<section class="content-header">
				<h1>用户管理</h1>
				<ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i>首页</a></li>
					<li class="active">用户管理</li>
				</ol>
			</section>

			<!-- Main content -->
			<section class="content">
				<div class="row">
					<div class="col-xs-12">

						<div class="box">
							<div class="box-header">
								<div class="sbaz_table">
									<p>
										<span class="float_left"><span>用户名：</span><input
											type="text" id="searchByName"></span> <span
											class="float_right" style="margin-right: 70%;"> <input
											type="button" onclick="searchResult();" value="查询"
											class="in_sub"> <input type="button"
											onclick="report();" value="导出" class="in_sub"> 
										</span>
									<div class="clear"></div>

								</div>
							</div>
							<!-- /.box-header -->
							<div class="box-body">
								<table id="example1" class="table table-bordered table-striped">
									<thead>
										<tr>
											<td>序号</td>
											<td>用户名</td>
											<td>用户属性</td>
											<td>创建时间</td>
											<td>更新时间</td>
											<td>更新者</td>
											<td>状态</td>
											<td>操作</td>
										</tr>

									</thead>
									<tbody>
									<tbody id="userList"></tbody>
									<tr>
										<td colspan="8" class="text_al_rig lindianjia"><input
											type="submit" value="添加用户" class="anniu lindianjia"
											onclick="add();"></td>
									</tr>
									<tr></tr>

									</tbody>
								</table>
								<!-- 分页插件 -->
								<div>
									<div class="list-page-tail page-down" id="user-show-pager"
										style="margin: auto;"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<!-- jQuery 3 -->
	<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap 3.3.7 -->
	<script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<!-- DataTables -->
	<script
		src="../../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
	<script
		src="../../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
	<!-- SlimScroll -->
	<script
		src="../../bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<!-- FastClick -->
	<script src="../../bower_components/fastclick/lib/fastclick.js"></script>
	<!-- AdminLTE App -->
	<script src="../../dist/js/adminlte.min.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="../../dist/js/demo.js"></script>
	<script src="dist/js/pager/data_table_pager.js"></script>
	<script src="vince/js/demo.js"></script>
	<!-- page script -->
	<script>
		$(function() {
			$('#example1').DataTable('paging'      : false,
				      'lengthChange': false,
				      'searching'   : false,
				      'ordering'    : false,
				      'info'        : false,
				      'autoWidth'   : false)
		})
		$(".fuceng").css({
			"display" : "none"
		});
	</script>
	<script src="dist/js/pager/data_table_pager.js"></script>
	<script type="text/javascript">
		jQuery(document).ready(function() {
			getUserList();
		});
		var globalResult;
		//获取用户列表
		function getUserList() {
			$
					.ajax({
						url : "user/selectAll",
						type : "post",
						dataType : "json",
						success : function(result) {
							globalResult = result;
							var userlist = "";
							//设置分页信息——当前为假分页
							var totalSize = result.length;
							var pageSize = 15;
							var totalNum = Math.ceil(totalSize / pageSize);
							var startIndex = (pageNum - 1) * pageSize;
							var endIndex = (pageNum * pageSize > totalSize) ? totalSize
									: pageNum * pageSize;
							for (let i = startIndex; i < endIndex; i++) {
								userlist += "<tr class=\"\">";
								userlist += "<td>" + (i + 1) + "</td>";
								userlist += "<td>" + result[i].userName
										+ "</td>";
								userlist += "<td>" + result[i].comments
										+ "</td>";
								userlist += "<td>" + result[i].createTime
										+ "</td>";
								userlist += "<td>" + result[i].updateTime
										+ "</td>";
								userlist += "<td>" + result[i].updater
										+ "</td>";
								if (result[i].isdel == "N") {
									userlist += "<td>启用</td>";
								} else {
									userlist += "<td>已删除</td>";
								}
								userlist += "<td class=\"center\" >";
								/* userlist += "<a class=\" edit\" onclick=\"getUserEdit('"+result[i].id+"');\">编辑</a>&nbsp;"; */
								userlist += "<a class=\" edit\" onclick=\"getUserEdit('"
										+ i + "');\">编辑</a>&nbsp;";
								userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"
										+ result[i].id + "');\">删除</a>&nbsp;";
								userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"
										+ result[i].id + "');\">密码初始化</a>";
								userlist += "</td>";
								userlist += "</tr>";
							}
							$("#userList").html(userlist);
							//加载页码
							$("#user-show-pager").html(
									loadPages(pageSize, totalSize, pageNum));
							$("#user-show-pager").setActivePage(2);
						}
					});
		}
		function close2() {
			$(".fuceng").css({
				"display" : "none"
			});

		}
		function add() {
			$(".fuceng").css({
				"display" : "block"
			});
			document.getElementById("userform").reset();
		}
		//编辑用户
		function getUserEdit(param) {
			$(".fuceng").css({
				"display" : "block"
			});
			$("#username").val(globalResult[param].userName);
			$("#password").val(globalResult[param].password);
			$("#confirm").val(globalResult[param].password);
			$("#isdel").val(globalResult[param].isdel);
			$("#comments").val(globalResult[param].comments);
		}
		//删除用户
		function getUserDelete(param) {
			if (confirm("确定删除此用户？")) {
				$.ajax({
					url : "user/delete",
					type : "post",
					data : {
						"userId" : param
					},
					dataType : "json",
					success : function(result) {
						if (!result.success) {
							alert("删除失败！");
						}
						getUserList();
					}
				});
			}
		}
		//用户密码初始化
		function initUserPassword(param) {
			userId = param;
			if (confirm("确认将该用户的密码初始化？")) {
				$.ajax({
					url : "user/initUserPassword",
					type : "post",
					data : {
						"userId" : param
					},
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("密码初始化成功！");
						} else {
							alert("密码初始化失败！");
						}
						getUserList();
					}
				});
			}
		}
		//搜索用户
		function searchResult() {
			var name = $("#searchByName").val().trim();
			if (name != "") {
				$
						.ajax({
							url : "user/selectByUserName",
							type : "post",
							data : {
								"userName" : name
							},
							dataType : "json",
							success : function(result) {
								//alert("数据到前台");
								var userlist = "";
								for (let i = 0; i < result.length; i++) {
									userlist += "<tr class=\"\">";
									userlist += "<td>" + (i + 1) + "</td>";
									userlist += "<td>" + result[i].userName
											+ "</td>";
									userlist += "<td>" + result[i].comments
											+ "</td>";
									userlist += "<td>" + result[i].createTime
											+ "</td>";
									userlist += "<td>" + result[i].updateTime
											+ "</td>";
									userlist += "<td>" + result[i].updater
											+ "</td>";
									if (result[i].isdel == "N") {
										userlist += "<td>启用</td>";
									} else {
										userlist += "<td>已删除</td>";
									}
									userlist += "<td class=\"center\" >";
									userlist += "<a class=\" lindianjia\" >编辑</a>&nbsp;";
									userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"
											+ result[i].id
											+ "');\">删除</a>&nbsp;";
									userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"
											+ result[i].id + "');\">密码初始化</a>";
									userlist += "</td>";
									userlist += "</tr>";
								}
								$("#userList").html(userlist);
							}
						});
			}
		}
		//修改用户密码
		function updatePsw() {
			let title = "修改密码";
			let url = "formHtml/user/updatePass.html";
			var params = {
				"width" : 600,
				"height" : 250
			};
			parent.openModal(title, url, params);

		}
		//导出
		function report() {
			$.ajax({
				url : "user/recordExport",
				type : "post",
				// data: {"path": param},
				dataType : "json",
				success : function(result) {
					if (result.success) {
						alert("导出成功！");
					} else {
						alert("导出失败！");
					}
				}
			});
		}
		//提交用户信息
		function submitUserInfo() {
			var username = $("#username").val();
			var confirm = $("#confirm").val();
			var password = $("#password").val();
			var isdel = $("#isdel").val();
			var comments = $("#comments").val();
			if (password.trim() == "") {
				alert("密码不能为空！");
			} else if (confirm.trim() == "") {
				alert("请确认密码！");
			} else if (password != confirm) {
				alert("输入密码前后不一致，请检查！");
			} else {
				$.ajax({
					url : "user/update",
					type : "post",
					data : {
						"userName" : username,
						"password" : password,
						"confirm" : confirm,
						"isdel" : isdel,
						"comments" : comments
					},
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("操作成功！");
						} else {
							alert(result.message);
						}
						getUserList();
					}
				});
				$(".fuceng").css({
					"display" : "none"
				})
			}
		}
		
	</script>
</body>
</html>
