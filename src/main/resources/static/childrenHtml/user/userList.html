<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=10">
<title>用户管理</title>
<meta
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
	name="viewport">
<link rel="stylesheet" href="bootstrap/css/bootstrap.css">
<link rel="stylesheet" href="dist/css/ionicons.min.css">
<link rel="stylesheet" href="dist/css/AdminLTE.css">
<link rel="stylesheet" href="dist/css/skins/_all-skins.css">
<link rel="stylesheet" href="vince/css/vince.css">
<link rel="stylesheet" href="vince/biao/css/font-awesome.min.css">
<link rel="stylesheet" href="dist/js/pager/pager.css">
<!--[if lt IE 9]>
  <script src="dist/js/html5shiv.min.js"></script>
  <script src="dist/js/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">

	<div class="fuceng">
		<div class="fuqu">
			<div class="fuquzone">
				<div class="fuqulogo"></div>
				<p class="fuqutitle">
					用户信息 <span class="fuclose">×</span>
				</p>
				<div class="fuqubiao" id="userForm">
					<p>
						<span>用户名</span><input type="text" class="right_input" value=""
							id="username" name="userName" />
					</p>
					<p>
						<span>登录密码：</span><input type="password" class="right_input"
							value="" id="password" name="password" />
					</p>
					<p>
						<span>确认密码：</span><input type="password" class="right_input"
							value="" id="confirm" />
					</p>
					<p style="overflow: hidden">
						<span>状态：</span> <span class="rad"> <label for="keyong">启用</label>
							<input type="radio" name="kf" id="isdel" checked="checked" />
						</span> <span class="rad"> <label for="bukeyong">禁用</label> <input
							type="radio" name="kf" id="isdel" />
						</span>
					</p>
					<p style="height: 80px;">
						<span>用户属性:</span> <input type="text" class="right_input" value=""
							id="comments" name="comments" />
					</p>
				</div>

				<div class="fuqusave">
					<input type="button" onclick="submitUserInfo();" value="保存">
				</div>
			</div>
		</div>
	</div>


	<div class="wrapper">
		<section class="content-header">
			<ol class="breadcrumb">
				<li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
				<li class="active">用户管理</li>
			</ol>
		</section>
		<div class="content qqq">
			<div class="user">
				<div class="ssjc_right_up">
					<div class="nei">

						<div class="sbaz_table">
							<p>
								<span class="float_left"><span>用户名：</span><input
									type="text" id="searchByName"></span> <span
									class="float_right"> <input type="button"
									onclick="searchResult();" value="查询" class="in_sub"> <input
									type="button" onclick="report();" value="导出" class="in_sub">
									<!-- <input type="button" onclick="getUserList();" value="刷新"
									class="in_sub"> -->
								</span>
							<div class="clear"></div>

						</div>
					</div>
					<div class="ssjc_right_bottom">
						<div class="nei">
							<p></p>
							<div class="ssjc_rub_table">
								<table class="tj_table">
									<thead>
										<tr>
											<td>序号</td>
											<td>用户名</td>
											<td>用户属性</td>
											<td>创建时间</td>
											<td>更新时间</td>
											<td>更新者</td>
											<td>状态</td>
											<td>操作</td>
										</tr>

									</thead>
									<tbody>
									<tbody id="userList"></tbody>
									<tr>
										<td colspan="8" class="text_al_rig lindianjia"><input
											type="submit" value="添加用户" class="anniu lindianjia"></td>
									</tr>
									<tr></tr>

									</tbody>
								</table>
								<!-- 分页插件 -->
								<div>
									<div class="list-page-tail page-down" id="user-show-pager"
										style="margin: auto;"></div>
								</div>
							</div>
							<div class="cheng_ershi"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer class="main-footer">
		<div class="pull-right hidden-xs">
			<b></b>
		</div>
		<strong>Copyright &copy; 2014-2016</strong>
	</footer>
	<div class="control-sidebar-bg"></div>
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<script src="dist/js/app.min.js"></script>
	<script src="dist/js/demo.js"></script>
	<script src="vince/js/nicescroll.js"></script>
	<script src="vince/js/demo.js"></script>
	<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
	<script src="vince/datapick/js/moment.js"></script>
	<script src="vince/datapick/js/daterangepicker.js"></script>
	<script src="dist/js/pager/data_table_pager.js"></script>
	<script type="text/javascript">
		jQuery(document).ready(function() {
			getUserList();
		});
		var globalResult;
		//获取用户列表
		function getUserList() {
			$.ajax({
						url : "user/selectAll",
						type : "post",
						dataType : "json",
						success : function(result) {
							globalResult = result;
							var userlist = "";
							//设置分页信息——当前为假分页
							var totalSize = result.length;
							var pageSize = 5;
							var totalNum = Math.ceil(totalSize / pageSize);
							var startIndex = (pageNum - 1) * pageSize;
							var endIndex = (pageNum * pageSize > totalSize) ? totalSize
									: pageNum * pageSize;
							for (let i = startIndex; i < endIndex; i++) {
								userlist += "<tr class=\"\">";
								userlist += "<td>" + (i + 1) + "</td>";
								userlist += "<td>"+result[i].userName+"</td>";
								userlist += "<td>"+result[i].comments+"</td>";
								userlist += "<td>"+result[i].createTime+"</td>";
								userlist += "<td>"+result[i].updateTime+"</td>";
								userlist += "<td>"+result[i].updater+"</td>";
								if (result[i].isdel == "N") {
									userlist += "<td>启用</td>";
								} else {
									userlist += "<td>已删除</td>";
								}
								userlist += "<td class=\"center\" >";
								/* userlist += "<a class=\" edit\" onclick=\"getUserEdit('"+result[i].id+"');\">编辑</a>&nbsp;"; */
								userlist += "<a class=\" edit\" onclick=\"getUserEdit('"+result[i].id+"');\">编辑</a>&nbsp;";
								userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"+result[i].id+"');\">删除</a>&nbsp;";
								userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"+result[i].id+"');\">密码初始化</a>";
								userlist += "</td>";
								userlist += "</tr>";
							}
							$("#userList").html(userlist);
							//加载页码
							$("#user-show-pager").html(loadPages(pageSize, totalSize, pageNum));
							$("#user-show-pager").setActivePage(2);
						}
					});
		}
		//编辑用户
		function getUserEdit(param) {
			$(".fuceng").css({
				"display" : "block"
			});
			$("#username").val(globalResult[param].userName);
			$("#password").val(globalResult[param].password);
			$("#confirm").val(globalResult[param].password);
			$("#isdel").val(globalResult[param].isdel);
			$("#comments").val(globalResult[param].comments);
		}
		//删除用户
		function getUserDelete(param) {
			if (confirm("确定删除此用户？")) {
				$.ajax({
					url : "user/delete",
					type : "post",
					data : {"userId" : param},
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("删除成功！");
						} else {
							alert("删除失败！");
						}
						getUserList();
					}
				});
			}
		}
		//用户密码初始化
		function initUserPassword(param) {
			userId = param;
			if (confirm("确认将该用户的密码初始化？")) {
				$.ajax({
					url : "user/initUserPassword",
					type : "post",
					data : {
						"userId" : param
					},
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("密码初始化成功！");
						} else {
							alert("密码初始化失败！");
						}
						getUserList();
					}
				});
			}
		}
		//搜索用户
		function searchResult() {
			var name = $("#searchByName").val().trim();
			if (name != "") {
				$
						.ajax({
							url : "user/selectByUserName",
							type : "post",
							data : {
								"userName" : name
							},
							dataType : "json",
							success : function(result) {
								//alert("数据到前台");
								var userlist = "";
								for (let i = 0; i < result.length; i++) {
									userlist += "<tr class=\"\">";
									userlist += "<td>" + (i + 1) + "</td>";
									userlist += "<td>" + result[i].userName
											+ "</td>";
									userlist += "<td>" + result[i].comments
											+ "</td>";
									userlist += "<td>" + result[i].createTime
											+ "</td>";
									userlist += "<td>" + result[i].updateTime
											+ "</td>";
									userlist += "<td>" + result[i].updater
											+ "</td>";
									if (result[i].isdel == "N") {
										userlist += "<td>启用</td>";
									} else {
										userlist += "<td>已删除</td>";
									}
									userlist += "<td class=\"center\" >";
									userlist += "<a class=\" lindianjia\" >编辑</a>&nbsp;";
									userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"
											+ result[i].id
											+ "');\">删除</a>&nbsp;";
									userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"
											+ result[i].id + "');\">密码初始化</a>";
									userlist += "</td>";
									userlist += "</tr>";
								}
								$("#userList").html(userlist);
							}
						});
			}
		}
		//修改用户密码
		function updatePsw() {
			let title = "修改密码";
			let url = "formHtml/user/updatePass.html";
			var params = {
				"width" : 600,
				"height" : 250
			};
			parent.openModal(title, url, params);

		}
		//导出
		function report() {
			$.ajax({
				url : "user/recordExport",
				type : "post",
				// data: {"path": param},
				dataType : "json",
				success : function(result) {
					if (result.success) {
						alert("导出成功！");
					} else {
						alert("导出失败！");
					}
				}
			});
		}
		//提交用户信息
		function submitUserInfo() {
			var username = $("#username").val();
			var confirm = $("#confirm").val();
			var password = $("#password").val();
			var isdel = $("#isdel").val();
			var comments = $("#comments").val();
			if (password.trim() == "") {
				alert("密码不能为空！");
			} else if (confirm.trim() == "") {
				alert("请确认密码！");
			} else if (password != confirm) {
				alert("输入密码前后不一致，请检查！");
			} else {
				$.ajax({
					url : "user/update",
					type : "post",
					data : {
						"userName" : username,
						"password" : password,
						"confirm" : confirm,
						"isdel" : isdel,
						"comments" : comments
					},
					dataType : "json",
					success : function(result) {
						if (result.success) {
							alert("操作成功！");
						} else {
							alert(result.message);
						}
						getUserList();
					}
				});
				$(".fuceng").css({
					"display" : "none"
				})
			}
		}
	</script>
	<div id="sss" style="display: none; height: 200px; width: 200px;"></div>
	<script src="vince/js/echarts.min.js"></script>
</body>
</html>

