<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>用户列表</title>
		<link type="text/css" href="js/pager/pager.css" rel="stylesheet" />
	</head>
	<body style="width: 100%;">
		<div>
			<div class="row-fluid" style="width: 95%; height: 10%; margin-left: 1%;">
				<div>
					<h3 class="page-title">用户管理&nbsp;
						<small>此功能用于管理所有用户
							<a href="#" onclick="updatePsw();">修改登录用户密码</a>
						</small>
					</h3>
				</div>
				<ul class="breadcrumb">
					<li><i class="icon-home"></i><span class="icon-angle-right"></span></li>
					<li><a href="#">用户管理</a><span class="icon-angle-right"></span></li>
					<li><a href="#">用户列表</a></li>
				</ul>
			</div>
		</div>
		<!--加载用户列表【开始】-->
		<div class="portlet-body" style="width: 80%; margin: auto;">
			<!-- 按钮列 -->
			<div>
				<div style="margin: 10px 0px;">
					<button class="btn green" onclick="getUserEdit();">新增用户&nbsp;<i class="icon-plus"></i></button>
					<button class="btn blue" onclick="javascript: parent.openAlertInfo(12345);" style="margin: 0px 10px;">导出列表</button>
					<input type="text" id="searchByName" placeholder="请输入用户名称查询" style="height: 30px;" value="" onfocus="javascript: this.value=null;"/>
					<button  class="btn blue" onclick="searchResult();"><i class="icon-search"></i></button>
				</div>
			</div>
			<!-- 用户列表【开始】 -->
			<table class="table table-striped table-hover table-bordered" id="sample_editable_1">
				<thead>
					<tr> 
						<th>序号</th>			<th>登录名</th>	<th>用户状态</th>	<th>创建时间</th>
						<th>更新时间</th>	<th>更新者</th>	<th>备注</th>			<th>操作</th>
					</tr>
				</thead>
				<tbody id="userList"></tbody>
				<tfoot>
					<tr>
						<td colspan="8" align="center">
							<!-- 翻页插件 -->
							<div class="list-page-tail page-down" id="pager" style="margin: auto;"></div>
						</td>
					</tr>
				</tfoot>
			</table>
			<!-- 用户列表【结束】 -->
		</div>
		
		
		<script type="text/javascript" src="media/js/jquery-1.10.1.min.js"></script>
		<script type="text/javascript" src="js/pager/pager.js" ></script>
		<script>
			jQuery(document).ready(function() {
				getUserList();
			});
			//获取用户列表
			function getUserList(){
				$.ajax({
					url: "user/selectAll",
					type: "post",
					dataType: "json",
					success: function(result){
						var userlist = "";
						for(let i=0; i<result.length; i++){
							userlist += "<tr class=\"\">";
							userlist += "<td>"+(i+1)+"</td>";
							userlist += "<td>"+result[i].userName+"</td>";
							userlist += "<td>"+result[i].comments+"</td>";
							userlist += "<td>"+parent.formatDateToString(new Date(result[i].createTime))+"</td>";
							userlist += "<td>"+parent.formatDateToString(new Date(result[i].updateTime))+"</td>";
							userlist += "<td>"+result[i].updater+"</td>";
							if(result[i].isdel == "N"){userlist += "<td>启用</td>"; }
							else{userlist += "<td>已删除</td>";}
							userlist += "<td class=\"center\">";
							userlist += "<a class=\"edit\" href=\"#\" onclick=\"getUserEdit('"+result[i].id+"');\">编辑</a>&nbsp;";
							userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"+result[i].id+"');\">删除</a>&nbsp;";
							userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"+result[i].id+"');\">密码初始化</a>";
							userlist += "</td>";
							userlist += "</tr>";
						}
						$("#userList").html(userlist);
						//加载页码
						var totalSize = result.length;
						var totalPage = (totalSize%5 == 0)?(totalSize/5):(totalSize/5+1);
						totalPage = parseInt(totalPage);
						/* debugger;
						var pageHtml = loadAllPage(totalPage);
						$("#pager").loadAllPage(pageHtml);
						$("#pager").setActivePage(); */
					}
				});
			}
			//添加或者编辑用户
			function getUserEdit(param){
				let title;
				if(param == null){ title = "新增用户"; }
				else{ title = "编辑用户"; }
				let url = "formHtml/user/user-edit.html";
				var params = {"width": 600, "height": 450, "userId": param};
				parent.openModal(title, url, params);
			}
			//删除用户
			function getUserDelete(param){
				if(confirm("确定删除此用户？")){
					$.ajax({
						url: "user/delete",
						type: "post",
						data: {"userId": param},
						dataType: "json",
						success: function(result){
							if(result.success){ alert("删除成功！"); }
							else{ alert("删除失败！"); }
							getUserList();
						}
					});
				}
			}
			//用户密码初始化
			function initUserPassword(param){
				userId=param;
				if(confirm("确认将该用户的密码初始化？")){
					$.ajax({
						url: "user/initUserPassword",
						type: "post",
						data: {"userId": param},
						dataType: "json",
						success: function(result){
							if(result.success){ alert("密码初始化成功！"); }
							else{ alert("密码初始化失败！"); }
							getUserList();
						}
					});
				}
			}
			//搜索用户
			function searchResult(){
				var name = $("#searchByName").val().trim();
				alert(name);
				if(name != ""){
					$.ajax({
						url: "user/searchByUsername",
						type: "post",
						data: {"username": name},
						dataType: "json",
						success: function(result){
							alert("数据到前台");
							var userlist = "";
							for(let i=0; i<result.length; i++){
								userlist += "<tr class=\"\">";
								userlist += "<td>"+(i+1)+"</td>";
								userlist += "<td>"+result[i].userName+"</td>";
								if(result[i].isdel == "N"){userlist += "<td>启用</td>"; }
								else{userlist += "<td>已删除</td>";}
								userlist += "<td>"+result[i].comments+"</td>";
								userlist += "<td class=\"center\">";
								userlist += "<a class=\"details\" href=\"#\" onclick=\"getUserDetails('"+result[i].id+"');\">详情</a>&nbsp;";
								userlist += "<a class=\"edit\" href=\"#\" onclick=\"getUserEdit('"+result[i].id+"');\">编辑</a>&nbsp;";
								userlist += "<a class=\"delete\" href=\"#\" onclick=\"getUserDelete('"+result[i].id+"');\">删除</a>&nbsp;";
								userlist += "<a class=\"resetpsw\" href=\"#\" onclick=\"initUserPassword('"+result[i].id+"');\">密码初始化</a>";
								userlist += "</td>";
								userlist += "</tr>";
							}
							$("#userList").html(userlist);
						}
					});
				}
			}
			//修改用户密码
			function updatePsw(){
				let title = "修改密码";
				let url = "formHtml/user/updatePass.html";
				var params = {"width": 600, "height": 250};
				parent.openModal(title, url, params);
				
			}
		</script>
	</body>
</html>